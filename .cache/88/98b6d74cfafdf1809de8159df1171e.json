{"id":"xgI0","dependencies":[{"name":"D:\\nodebook\\IMI-CHAT-PREVIEW\\tsconfig.json","includedInParent":true,"mtime":1567169658822},{"name":"D:\\nodebook\\IMI-CHAT-PREVIEW\\package.json","includedInParent":true,"mtime":1569915690588},{"name":"./ajax","loc":{"line":3,"column":23},"parent":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\send-api.ts","resolved":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\ajax.ts"},{"name":"./environment","loc":{"line":4,"column":30},"parent":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\send-api.ts","resolved":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\environment.ts"},{"name":"./typings/send-api","loc":{"line":5,"column":27},"parent":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\send-api.ts","resolved":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\typings\\send-api.ts"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"./ajax\"),s=require(\"./environment\"),t=require(\"./typings/send-api\");function a(t,a,i){var n={consumer:s.environment.consumer,type:\"human\",msg:i,platform:\"web\",is_test:!1},r={enterprise_unique_name:a,\"bot-access-token\":t};return e.makePostReq({url:\"https://dev.imibot.ai/api/v1/webhook/web/\",body:n,headerData:r})}function i(e,s,a){return e.map(function(i,n){var r=n===e.length-1,o=Object.assign(Object.assign({},i),{bot_message_id:s,time:Date.now(),messageMediatype:null,sourceType:\"bot\",isLast:r,response_language:a});return o=\"media\"===Object.keys(i)[0]?Object.assign(Object.assign({},o),{messageMediatype:i.media[0]&&i.media[0].type,text:t.EBotMessageMediaType.image}):\"quick_reply\"===Object.keys(i)[0]?Object.assign(Object.assign({},o),{messageMediatype:t.EBotMessageMediaType.quickReply,text:i.quick_reply.text||t.EBotMessageMediaType.quickReply}):Object.assign(Object.assign({},o),{messageMediatype:t.EBotMessageMediaType.text})})}exports.sendMessageToBot=a,exports.serializeGeneratedMessagesToPreviewMessages=i;"},"sourceMaps":{"js":{"mappings":[{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":0}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":13}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":20}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":35}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":43}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":56}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":57}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":64}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":68}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":72}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":74}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":82}},{"source":"send-api.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":92}},{"source":"send-api.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":94}},{"source":"send-api.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":102}},{"source":"send-api.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":119}},{"source":"send-api.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":121}},{"source":"send-api.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":129}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":151}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":16},"generated":{"line":1,"column":160}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":33},"generated":{"line":1,"column":162}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":59},"generated":{"line":1,"column":164}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":91},"generated":{"line":1,"column":166}},{"source":"send-api.ts","name":null,"original":{"line":8,"column":10},"generated":{"line":1,"column":169}},{"source":"send-api.ts","name":null,"original":{"line":9,"column":10},"generated":{"line":1,"column":173}},{"source":"send-api.ts","name":null,"original":{"line":9,"column":17},"generated":{"line":1,"column":175}},{"source":"send-api.ts","name":null,"original":{"line":10,"column":20},"generated":{"line":1,"column":176}},{"source":"send-api.ts","name":null,"original":{"line":10,"column":20},"generated":{"line":1,"column":185}},{"source":"send-api.ts","name":null,"original":{"line":10,"column":20},"generated":{"line":1,"column":187}},{"source":"send-api.ts","name":null,"original":{"line":10,"column":32},"generated":{"line":1,"column":199}},{"source":"send-api.ts","name":null,"original":{"line":11,"column":16},"generated":{"line":1,"column":208}},{"source":"send-api.ts","name":null,"original":{"line":11,"column":16},"generated":{"line":1,"column":213}},{"source":"send-api.ts","name":null,"original":{"line":12,"column":15},"generated":{"line":1,"column":221}},{"source":"send-api.ts","name":null,"original":{"line":12,"column":15},"generated":{"line":1,"column":225}},{"source":"send-api.ts","name":null,"original":{"line":13,"column":20},"generated":{"line":1,"column":227}},{"source":"send-api.ts","name":null,"original":{"line":13,"column":20},"generated":{"line":1,"column":236}},{"source":"send-api.ts","name":null,"original":{"line":14,"column":19},"generated":{"line":1,"column":242}},{"source":"send-api.ts","name":null,"original":{"line":14,"column":19},"generated":{"line":1,"column":251}},{"source":"send-api.ts","name":null,"original":{"line":17,"column":10},"generated":{"line":1,"column":254}},{"source":"send-api.ts","name":null,"original":{"line":17,"column":35},"generated":{"line":1,"column":256}},{"source":"send-api.ts","name":null,"original":{"line":18,"column":8},"generated":{"line":1,"column":257}},{"source":"send-api.ts","name":null,"original":{"line":18,"column":32},"generated":{"line":1,"column":280}},{"source":"send-api.ts","name":null,"original":{"line":19,"column":28},"generated":{"line":1,"column":282}},{"source":"send-api.ts","name":null,"original":{"line":19,"column":28},"generated":{"line":1,"column":301}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":11},"generated":{"line":1,"column":304}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":11},"generated":{"line":1,"column":311}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":11},"generated":{"line":1,"column":313}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":37},"generated":{"line":1,"column":325}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":38},"generated":{"line":1,"column":326}},{"source":"send-api.ts","name":null,"original":{"line":8,"column":16},"generated":{"line":1,"column":330}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":43},"generated":{"line":1,"column":374}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":43},"generated":{"line":1,"column":379}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":49},"generated":{"line":1,"column":381}},{"source":"send-api.ts","name":null,"original":{"line":21,"column":49},"generated":{"line":1,"column":392}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":396}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":16},"generated":{"line":1,"column":405}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":60},"generated":{"line":1,"column":407}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":103},"generated":{"line":1,"column":409}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":128},"generated":{"line":1,"column":411}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":11},"generated":{"line":1,"column":414}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":11},"generated":{"line":1,"column":421}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":28},"generated":{"line":1,"column":423}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":32},"generated":{"line":1,"column":427}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":33},"generated":{"line":1,"column":436}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":65},"generated":{"line":1,"column":438}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":14},"generated":{"line":1,"column":441}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":14},"generated":{"line":1,"column":445}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":23},"generated":{"line":1,"column":447}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":33},"generated":{"line":1,"column":451}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":50},"generated":{"line":1,"column":453}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":59},"generated":{"line":1,"column":460}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":12},"generated":{"line":1,"column":462}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":23},"generated":{"line":1,"column":464}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":23},"generated":{"line":1,"column":471}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":23},"generated":{"line":1,"column":478}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":23},"generated":{"line":1,"column":485}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":23},"generated":{"line":1,"column":492}},{"source":"send-api.ts","name":null,"original":{"line":30,"column":15},"generated":{"line":1,"column":495}},{"source":"send-api.ts","name":null,"original":{"line":30,"column":22},"generated":{"line":1,"column":498}},{"source":"send-api.ts","name":null,"original":{"line":31,"column":12},"generated":{"line":1,"column":499}},{"source":"send-api.ts","name":null,"original":{"line":31,"column":12},"generated":{"line":1,"column":514}},{"source":"send-api.ts","name":null,"original":{"line":32,"column":12},"generated":{"line":1,"column":516}},{"source":"send-api.ts","name":null,"original":{"line":32,"column":18},"generated":{"line":1,"column":521}},{"source":"send-api.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":1,"column":526}},{"source":"send-api.ts","name":null,"original":{"line":33,"column":12},"generated":{"line":1,"column":532}},{"source":"send-api.ts","name":null,"original":{"line":33,"column":30},"generated":{"line":1,"column":549}},{"source":"send-api.ts","name":null,"original":{"line":34,"column":12},"generated":{"line":1,"column":554}},{"source":"send-api.ts","name":null,"original":{"line":34,"column":24},"generated":{"line":1,"column":565}},{"source":"send-api.ts","name":null,"original":{"line":35,"column":12},"generated":{"line":1,"column":571}},{"source":"send-api.ts","name":null,"original":{"line":35,"column":12},"generated":{"line":1,"column":578}},{"source":"send-api.ts","name":null,"original":{"line":36,"column":12},"generated":{"line":1,"column":580}},{"source":"send-api.ts","name":null,"original":{"line":36,"column":12},"generated":{"line":1,"column":598}},{"source":"send-api.ts","name":null,"original":{"line":59,"column":15},"generated":{"line":1,"column":602}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":12},"generated":{"line":1,"column":609}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":40},"generated":{"line":1,"column":611}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":12},"generated":{"line":1,"column":621}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":19},"generated":{"line":1,"column":628}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":24},"generated":{"line":1,"column":633}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":33},"generated":{"line":1,"column":636}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":23},"generated":{"line":1,"column":639}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":23},"generated":{"line":1,"column":646}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":23},"generated":{"line":1,"column":653}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":23},"generated":{"line":1,"column":660}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":23},"generated":{"line":1,"column":667}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":19},"generated":{"line":1,"column":670}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":30},"generated":{"line":1,"column":673}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":16},"generated":{"line":1,"column":674}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":35},"generated":{"line":1,"column":691}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":43},"generated":{"line":1,"column":693}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":49},"generated":{"line":1,"column":699}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":55},"generated":{"line":1,"column":703}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":63},"generated":{"line":1,"column":705}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":69},"generated":{"line":1,"column":711}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":72},"generated":{"line":1,"column":714}},{"source":"send-api.ts","name":null,"original":{"line":43,"column":16},"generated":{"line":1,"column":719}},{"source":"send-api.ts","name":null,"original":{"line":43,"column":22},"generated":{"line":1,"column":724}},{"source":"send-api.ts","name":null,"original":{"line":43,"column":22},"generated":{"line":1,"column":726}},{"source":"send-api.ts","name":null,"original":{"line":43,"column":43},"generated":{"line":1,"column":747}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":47},"generated":{"line":1,"column":755}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":19},"generated":{"line":1,"column":771}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":26},"generated":{"line":1,"column":778}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":31},"generated":{"line":1,"column":783}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":40},"generated":{"line":1,"column":786}},{"source":"send-api.ts","name":null,"original":{"line":46,"column":23},"generated":{"line":1,"column":789}},{"source":"send-api.ts","name":null,"original":{"line":46,"column":23},"generated":{"line":1,"column":796}},{"source":"send-api.ts","name":null,"original":{"line":46,"column":23},"generated":{"line":1,"column":803}},{"source":"send-api.ts","name":null,"original":{"line":46,"column":23},"generated":{"line":1,"column":810}},{"source":"send-api.ts","name":null,"original":{"line":46,"column":23},"generated":{"line":1,"column":817}},{"source":"send-api.ts","name":null,"original":{"line":47,"column":19},"generated":{"line":1,"column":820}},{"source":"send-api.ts","name":null,"original":{"line":47,"column":30},"generated":{"line":1,"column":823}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":16},"generated":{"line":1,"column":824}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":34},"generated":{"line":1,"column":841}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":34},"generated":{"line":1,"column":843}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":55},"generated":{"line":1,"column":864}},{"source":"send-api.ts","name":null,"original":{"line":49,"column":16},"generated":{"line":1,"column":875}},{"source":"send-api.ts","name":null,"original":{"line":49,"column":28},"generated":{"line":1,"column":880}},{"source":"send-api.ts","name":null,"original":{"line":49,"column":37},"generated":{"line":1,"column":882}},{"source":"send-api.ts","name":null,"original":{"line":49,"column":49},"generated":{"line":1,"column":894}},{"source":"send-api.ts","name":null,"original":{"line":49,"column":57},"generated":{"line":1,"column":900}},{"source":"send-api.ts","name":null,"original":{"line":49,"column":57},"generated":{"line":1,"column":902}},{"source":"send-api.ts","name":null,"original":{"line":49,"column":78},"generated":{"line":1,"column":923}},{"source":"send-api.ts","name":null,"original":{"line":53,"column":23},"generated":{"line":1,"column":936}},{"source":"send-api.ts","name":null,"original":{"line":53,"column":23},"generated":{"line":1,"column":943}},{"source":"send-api.ts","name":null,"original":{"line":53,"column":23},"generated":{"line":1,"column":950}},{"source":"send-api.ts","name":null,"original":{"line":53,"column":23},"generated":{"line":1,"column":957}},{"source":"send-api.ts","name":null,"original":{"line":53,"column":23},"generated":{"line":1,"column":964}},{"source":"send-api.ts","name":null,"original":{"line":54,"column":19},"generated":{"line":1,"column":967}},{"source":"send-api.ts","name":null,"original":{"line":54,"column":30},"generated":{"line":1,"column":970}},{"source":"send-api.ts","name":null,"original":{"line":55,"column":16},"generated":{"line":1,"column":971}},{"source":"send-api.ts","name":null,"original":{"line":55,"column":34},"generated":{"line":1,"column":988}},{"source":"send-api.ts","name":null,"original":{"line":55,"column":34},"generated":{"line":1,"column":990}},{"source":"send-api.ts","name":null,"original":{"line":55,"column":55},"generated":{"line":1,"column":1011}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":1020}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":1028}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":1045}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":1047}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":1055}},{"source":"send-api.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":1099}}],"sources":{"send-api.ts":"import {makePostReq} from \"./ajax\";\r\nimport {environment} from \"./environment\";\r\nimport {IHeaderData} from \"./typings/http\";\r\nimport {EBotMessageMediaType, IGeneratedMessageItem, IMessageData, ISendApiResp} from \"./typings/send-api\";\r\n\r\nexport function sendMessageToBot(bot_access_token: string, enterprise_unique_name: string, humanMessage: string): Promise<ISendApiResp> {\r\n    //const url = 'https://staging.imibot.ai/api/v1/webhook/web/';\r\n    const url = 'https://dev.imibot.ai/api/v1/webhook/web/';\r\n    const body = {\r\n        \"consumer\": environment.consumer,\r\n        \"type\": \"human\",\r\n        \"msg\": humanMessage,\r\n        \"platform\": \"web\",\r\n        \"is_test\": false\r\n    };\r\n\r\n    const headerData:IHeaderData = {\r\n        enterprise_unique_name: enterprise_unique_name,\r\n        \"bot-access-token\": bot_access_token\r\n    }\r\n    return makePostReq<ISendApiResp>({url, body, headerData})\r\n}\r\n\r\n\r\nexport function serializeGeneratedMessagesToPreviewMessages(generatedMessage: IGeneratedMessageItem[], bot_message_id?: number, response_language?): IMessageData[] {\r\n\r\n    return generatedMessage.map((message: IGeneratedMessageItem, index) => {\r\n        const isLast = index === generatedMessage.length - 1;\r\n        let messageData: IMessageData = {\r\n            ...message,\r\n            bot_message_id,\r\n            time: Date.now(),\r\n            messageMediatype: null,\r\n            sourceType: 'bot',\r\n            isLast,\r\n            response_language\r\n        };\r\n\r\n        if (Object.keys(message)[0] === 'media') {\r\n            messageData = {\r\n                ...messageData,\r\n                messageMediatype:  message.media[0] && message.media[0].type,\r\n                text: EBotMessageMediaType.image, // this is for preview of last message in chat room list,\r\n            };\r\n        } else if (Object.keys(message)[0] === 'quick_reply') {\r\n            messageData = {\r\n                ...messageData,\r\n                messageMediatype: EBotMessageMediaType.quickReply, //\r\n                text: (<any>message).quick_reply.text || EBotMessageMediaType.quickReply, // this is for preview of last message in chat room list\r\n            };\r\n        } else {\r\n            /*if message type = text*/\r\n            messageData = {\r\n                ...messageData,\r\n                messageMediatype: EBotMessageMediaType.text,\r\n            };\r\n        }\r\n\r\n        return messageData;\r\n\r\n\r\n    });\r\n}\r\n"},"lineCount":null}},"error":null,"hash":"b1ae1d2616476c3aefa6a60769ae2097","cacheData":{"env":{}}}