{"id":"xgI0","dependencies":[{"name":"D:\\nodebook\\IMI-CHAT-PREVIEW\\tsconfig.json","includedInParent":true,"mtime":1567169658822},{"name":"D:\\nodebook\\IMI-CHAT-PREVIEW\\package.json","includedInParent":true,"mtime":1569915326222},{"name":"./ajax","loc":{"line":3,"column":23},"parent":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\send-api.ts","resolved":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\ajax.ts"},{"name":"./environment","loc":{"line":4,"column":30},"parent":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\send-api.ts","resolved":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\environment.ts"},{"name":"./typings/send-api","loc":{"line":5,"column":27},"parent":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\send-api.ts","resolved":"D:\\nodebook\\IMI-CHAT-PREVIEW\\src\\typings\\send-api.ts"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"./ajax\"),s=require(\"./environment\"),t=require(\"./typings/send-api\");function a(t,a,i){var n={consumer:s.environment.consumer,type:\"human\",msg:i,platform:\"web\",is_test:!1},r={enterprise_unique_name:a,\"bot-access-token\":t};return e.makePostReq({url:\"https://staging.imibot.ai/api/v1/webhook/web/\",body:n,headerData:r})}function i(e,s,a){return e.map(function(i,n){var r=n===e.length-1,o=Object.assign(Object.assign({},i),{bot_message_id:s,time:Date.now(),messageMediatype:null,sourceType:\"bot\",isLast:r,response_language:a});return o=\"media\"===Object.keys(i)[0]?Object.assign(Object.assign({},o),{messageMediatype:i.media[0]&&i.media[0].type,text:t.EBotMessageMediaType.image}):\"quick_reply\"===Object.keys(i)[0]?Object.assign(Object.assign({},o),{messageMediatype:t.EBotMessageMediaType.quickReply,text:i.quick_reply.text||t.EBotMessageMediaType.quickReply}):Object.assign(Object.assign({},o),{messageMediatype:t.EBotMessageMediaType.text})})}exports.sendMessageToBot=a,exports.serializeGeneratedMessagesToPreviewMessages=i;"},"sourceMaps":{"js":{"mappings":[{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":0}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":13}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":20}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":35}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":43}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":56}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":57}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":64}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":68}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":72}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":74}},{"source":"send-api.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":82}},{"source":"send-api.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":92}},{"source":"send-api.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":94}},{"source":"send-api.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":102}},{"source":"send-api.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":119}},{"source":"send-api.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":121}},{"source":"send-api.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":129}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":151}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":16},"generated":{"line":1,"column":160}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":33},"generated":{"line":1,"column":162}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":59},"generated":{"line":1,"column":164}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":91},"generated":{"line":1,"column":166}},{"source":"send-api.ts","name":null,"original":{"line":7,"column":10},"generated":{"line":1,"column":169}},{"source":"send-api.ts","name":null,"original":{"line":8,"column":10},"generated":{"line":1,"column":173}},{"source":"send-api.ts","name":null,"original":{"line":8,"column":17},"generated":{"line":1,"column":175}},{"source":"send-api.ts","name":null,"original":{"line":9,"column":20},"generated":{"line":1,"column":176}},{"source":"send-api.ts","name":null,"original":{"line":9,"column":20},"generated":{"line":1,"column":185}},{"source":"send-api.ts","name":null,"original":{"line":9,"column":20},"generated":{"line":1,"column":187}},{"source":"send-api.ts","name":null,"original":{"line":9,"column":32},"generated":{"line":1,"column":199}},{"source":"send-api.ts","name":null,"original":{"line":10,"column":16},"generated":{"line":1,"column":208}},{"source":"send-api.ts","name":null,"original":{"line":10,"column":16},"generated":{"line":1,"column":213}},{"source":"send-api.ts","name":null,"original":{"line":11,"column":15},"generated":{"line":1,"column":221}},{"source":"send-api.ts","name":null,"original":{"line":11,"column":15},"generated":{"line":1,"column":225}},{"source":"send-api.ts","name":null,"original":{"line":12,"column":20},"generated":{"line":1,"column":227}},{"source":"send-api.ts","name":null,"original":{"line":12,"column":20},"generated":{"line":1,"column":236}},{"source":"send-api.ts","name":null,"original":{"line":13,"column":19},"generated":{"line":1,"column":242}},{"source":"send-api.ts","name":null,"original":{"line":13,"column":19},"generated":{"line":1,"column":251}},{"source":"send-api.ts","name":null,"original":{"line":16,"column":10},"generated":{"line":1,"column":254}},{"source":"send-api.ts","name":null,"original":{"line":16,"column":35},"generated":{"line":1,"column":256}},{"source":"send-api.ts","name":null,"original":{"line":17,"column":8},"generated":{"line":1,"column":257}},{"source":"send-api.ts","name":null,"original":{"line":17,"column":32},"generated":{"line":1,"column":280}},{"source":"send-api.ts","name":null,"original":{"line":18,"column":28},"generated":{"line":1,"column":282}},{"source":"send-api.ts","name":null,"original":{"line":18,"column":28},"generated":{"line":1,"column":301}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":11},"generated":{"line":1,"column":304}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":11},"generated":{"line":1,"column":311}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":11},"generated":{"line":1,"column":313}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":37},"generated":{"line":1,"column":325}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":38},"generated":{"line":1,"column":326}},{"source":"send-api.ts","name":null,"original":{"line":7,"column":16},"generated":{"line":1,"column":330}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":43},"generated":{"line":1,"column":378}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":43},"generated":{"line":1,"column":383}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":49},"generated":{"line":1,"column":385}},{"source":"send-api.ts","name":null,"original":{"line":20,"column":49},"generated":{"line":1,"column":396}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":400}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":16},"generated":{"line":1,"column":409}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":60},"generated":{"line":1,"column":411}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":103},"generated":{"line":1,"column":413}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":128},"generated":{"line":1,"column":415}},{"source":"send-api.ts","name":null,"original":{"line":26,"column":11},"generated":{"line":1,"column":418}},{"source":"send-api.ts","name":null,"original":{"line":26,"column":11},"generated":{"line":1,"column":425}},{"source":"send-api.ts","name":null,"original":{"line":26,"column":28},"generated":{"line":1,"column":427}},{"source":"send-api.ts","name":null,"original":{"line":26,"column":32},"generated":{"line":1,"column":431}},{"source":"send-api.ts","name":null,"original":{"line":26,"column":33},"generated":{"line":1,"column":440}},{"source":"send-api.ts","name":null,"original":{"line":26,"column":65},"generated":{"line":1,"column":442}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":14},"generated":{"line":1,"column":445}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":14},"generated":{"line":1,"column":449}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":23},"generated":{"line":1,"column":451}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":33},"generated":{"line":1,"column":455}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":50},"generated":{"line":1,"column":457}},{"source":"send-api.ts","name":null,"original":{"line":27,"column":59},"generated":{"line":1,"column":464}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":12},"generated":{"line":1,"column":466}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":23},"generated":{"line":1,"column":468}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":23},"generated":{"line":1,"column":475}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":23},"generated":{"line":1,"column":482}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":23},"generated":{"line":1,"column":489}},{"source":"send-api.ts","name":null,"original":{"line":28,"column":23},"generated":{"line":1,"column":496}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":15},"generated":{"line":1,"column":499}},{"source":"send-api.ts","name":null,"original":{"line":29,"column":22},"generated":{"line":1,"column":502}},{"source":"send-api.ts","name":null,"original":{"line":30,"column":12},"generated":{"line":1,"column":503}},{"source":"send-api.ts","name":null,"original":{"line":30,"column":12},"generated":{"line":1,"column":518}},{"source":"send-api.ts","name":null,"original":{"line":31,"column":12},"generated":{"line":1,"column":520}},{"source":"send-api.ts","name":null,"original":{"line":31,"column":18},"generated":{"line":1,"column":525}},{"source":"send-api.ts","name":null,"original":{"line":31,"column":23},"generated":{"line":1,"column":530}},{"source":"send-api.ts","name":null,"original":{"line":32,"column":12},"generated":{"line":1,"column":536}},{"source":"send-api.ts","name":null,"original":{"line":32,"column":30},"generated":{"line":1,"column":553}},{"source":"send-api.ts","name":null,"original":{"line":33,"column":12},"generated":{"line":1,"column":558}},{"source":"send-api.ts","name":null,"original":{"line":33,"column":24},"generated":{"line":1,"column":569}},{"source":"send-api.ts","name":null,"original":{"line":34,"column":12},"generated":{"line":1,"column":575}},{"source":"send-api.ts","name":null,"original":{"line":34,"column":12},"generated":{"line":1,"column":582}},{"source":"send-api.ts","name":null,"original":{"line":35,"column":12},"generated":{"line":1,"column":584}},{"source":"send-api.ts","name":null,"original":{"line":35,"column":12},"generated":{"line":1,"column":602}},{"source":"send-api.ts","name":null,"original":{"line":58,"column":15},"generated":{"line":1,"column":606}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":12},"generated":{"line":1,"column":613}},{"source":"send-api.ts","name":null,"original":{"line":38,"column":40},"generated":{"line":1,"column":615}},{"source":"send-api.ts","name":null,"original":{"line":38,"column":12},"generated":{"line":1,"column":625}},{"source":"send-api.ts","name":null,"original":{"line":38,"column":19},"generated":{"line":1,"column":632}},{"source":"send-api.ts","name":null,"original":{"line":38,"column":24},"generated":{"line":1,"column":637}},{"source":"send-api.ts","name":null,"original":{"line":38,"column":33},"generated":{"line":1,"column":640}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":23},"generated":{"line":1,"column":643}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":23},"generated":{"line":1,"column":650}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":23},"generated":{"line":1,"column":657}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":23},"generated":{"line":1,"column":664}},{"source":"send-api.ts","name":null,"original":{"line":39,"column":23},"generated":{"line":1,"column":671}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":19},"generated":{"line":1,"column":674}},{"source":"send-api.ts","name":null,"original":{"line":40,"column":30},"generated":{"line":1,"column":677}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":16},"generated":{"line":1,"column":678}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":34},"generated":{"line":1,"column":695}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":42},"generated":{"line":1,"column":697}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":48},"generated":{"line":1,"column":703}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":54},"generated":{"line":1,"column":707}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":62},"generated":{"line":1,"column":709}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":68},"generated":{"line":1,"column":715}},{"source":"send-api.ts","name":null,"original":{"line":41,"column":71},"generated":{"line":1,"column":718}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":16},"generated":{"line":1,"column":723}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":22},"generated":{"line":1,"column":728}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":22},"generated":{"line":1,"column":730}},{"source":"send-api.ts","name":null,"original":{"line":42,"column":43},"generated":{"line":1,"column":751}},{"source":"send-api.ts","name":null,"original":{"line":44,"column":47},"generated":{"line":1,"column":759}},{"source":"send-api.ts","name":null,"original":{"line":44,"column":19},"generated":{"line":1,"column":775}},{"source":"send-api.ts","name":null,"original":{"line":44,"column":26},"generated":{"line":1,"column":782}},{"source":"send-api.ts","name":null,"original":{"line":44,"column":31},"generated":{"line":1,"column":787}},{"source":"send-api.ts","name":null,"original":{"line":44,"column":40},"generated":{"line":1,"column":790}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":23},"generated":{"line":1,"column":793}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":23},"generated":{"line":1,"column":800}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":23},"generated":{"line":1,"column":807}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":23},"generated":{"line":1,"column":814}},{"source":"send-api.ts","name":null,"original":{"line":45,"column":23},"generated":{"line":1,"column":821}},{"source":"send-api.ts","name":null,"original":{"line":46,"column":19},"generated":{"line":1,"column":824}},{"source":"send-api.ts","name":null,"original":{"line":46,"column":30},"generated":{"line":1,"column":827}},{"source":"send-api.ts","name":null,"original":{"line":47,"column":16},"generated":{"line":1,"column":828}},{"source":"send-api.ts","name":null,"original":{"line":47,"column":34},"generated":{"line":1,"column":845}},{"source":"send-api.ts","name":null,"original":{"line":47,"column":34},"generated":{"line":1,"column":847}},{"source":"send-api.ts","name":null,"original":{"line":47,"column":55},"generated":{"line":1,"column":868}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":16},"generated":{"line":1,"column":879}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":28},"generated":{"line":1,"column":884}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":37},"generated":{"line":1,"column":886}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":49},"generated":{"line":1,"column":898}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":57},"generated":{"line":1,"column":904}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":57},"generated":{"line":1,"column":906}},{"source":"send-api.ts","name":null,"original":{"line":48,"column":78},"generated":{"line":1,"column":927}},{"source":"send-api.ts","name":null,"original":{"line":52,"column":23},"generated":{"line":1,"column":940}},{"source":"send-api.ts","name":null,"original":{"line":52,"column":23},"generated":{"line":1,"column":947}},{"source":"send-api.ts","name":null,"original":{"line":52,"column":23},"generated":{"line":1,"column":954}},{"source":"send-api.ts","name":null,"original":{"line":52,"column":23},"generated":{"line":1,"column":961}},{"source":"send-api.ts","name":null,"original":{"line":52,"column":23},"generated":{"line":1,"column":968}},{"source":"send-api.ts","name":null,"original":{"line":53,"column":19},"generated":{"line":1,"column":971}},{"source":"send-api.ts","name":null,"original":{"line":53,"column":30},"generated":{"line":1,"column":974}},{"source":"send-api.ts","name":null,"original":{"line":54,"column":16},"generated":{"line":1,"column":975}},{"source":"send-api.ts","name":null,"original":{"line":54,"column":34},"generated":{"line":1,"column":992}},{"source":"send-api.ts","name":null,"original":{"line":54,"column":34},"generated":{"line":1,"column":994}},{"source":"send-api.ts","name":null,"original":{"line":54,"column":55},"generated":{"line":1,"column":1015}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":1024}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":1032}},{"source":"send-api.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":1049}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":1051}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":1059}},{"source":"send-api.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":1,"column":1103}}],"sources":{"send-api.ts":"import {makePostReq} from \"./ajax\";\r\nimport {environment} from \"./environment\";\r\nimport {IHeaderData} from \"./typings/http\";\r\nimport {EBotMessageMediaType, IGeneratedMessageItem, IMessageData, ISendApiResp} from \"./typings/send-api\";\r\n\r\nexport function sendMessageToBot(bot_access_token: string, enterprise_unique_name: string, humanMessage: string): Promise<ISendApiResp> {\r\n    const url = 'https://staging.imibot.ai/api/v1/webhook/web/';\r\n    const body = {\r\n        \"consumer\": environment.consumer,\r\n        \"type\": \"human\",\r\n        \"msg\": humanMessage,\r\n        \"platform\": \"web\",\r\n        \"is_test\": false\r\n    };\r\n\r\n    const headerData:IHeaderData = {\r\n        enterprise_unique_name: enterprise_unique_name,\r\n        \"bot-access-token\": bot_access_token\r\n    }\r\n    return makePostReq<ISendApiResp>({url, body, headerData})\r\n}\r\n\r\n\r\nexport function serializeGeneratedMessagesToPreviewMessages(generatedMessage: IGeneratedMessageItem[], bot_message_id?: number, response_language?): IMessageData[] {\r\n\r\n    return generatedMessage.map((message: IGeneratedMessageItem, index) => {\r\n        const isLast = index === generatedMessage.length - 1;\r\n        let messageData: IMessageData = {\r\n            ...message,\r\n            bot_message_id,\r\n            time: Date.now(),\r\n            messageMediatype: null,\r\n            sourceType: 'bot',\r\n            isLast,\r\n            response_language\r\n        };\r\n\r\n        if (Object.keys(message)[0] === 'media') {\r\n            messageData = {\r\n                ...messageData,\r\n                messageMediatype: message.media[0] && message.media[0].type,\r\n                text: EBotMessageMediaType.image, // this is for preview of last message in chat room list,\r\n            };\r\n        } else if (Object.keys(message)[0] === 'quick_reply') {\r\n            messageData = {\r\n                ...messageData,\r\n                messageMediatype: EBotMessageMediaType.quickReply, //\r\n                text: (<any>message).quick_reply.text || EBotMessageMediaType.quickReply, // this is for preview of last message in chat room list\r\n            };\r\n        } else {\r\n            /*if message type = text*/\r\n            messageData = {\r\n                ...messageData,\r\n                messageMediatype: EBotMessageMediaType.text,\r\n            };\r\n        }\r\n\r\n        return messageData;\r\n\r\n\r\n    });\r\n}\r\n\r\n"},"lineCount":null}},"error":null,"hash":"a9538110b2c3c582d5e0ed1526b6ad91","cacheData":{"env":{}}}